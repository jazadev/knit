<!-- sidebar -->
<aside class="fixed inset-y-0 left-0 z-40 w-64 flex flex-col transition-transform duration-300 transform md:translate-x-0 md:relative
                  bg-gray-100 dark:bg-gray-900 
                  border-r border-gray-200 dark:border-gray-700
                  text-gray-900 dark:text-white h-screen shadow-2xl md:shadow-none"
    :class="mobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'">
    <!-- Cerrar (Móvil) -->
    <div class="md:hidden absolute top-2 right-2 z-50">
        <button @click="mobileMenuOpen = false" class="p-2 text-gray-500 hover:text-red-500 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    <!-- logo sidebar -->
    <a href="/"
        class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-3 hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors group">

        <div
            class="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-sm group-hover:scale-110 transition-transform flex-shrink-0">
            <svg viewBox="0 0 869 645" class="w-5 h-5" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <g transform="matrix(1,0,0,1,-728.95,-304.56)">
                    <g transform="matrix(1.37,0,0,1.37,-289.82,-313.56)">
                        <path
                            d="M744,452L746,910L825,911L824,564L905.59,662.322L985.286,744.771L1043,797L1101,752C1101,752 1029.218,688.01 1001.551,658.177C977.051,631.758 939.759,595.196 935,573C930.722,553.046 926.167,529.833 966,524C983.866,521.384 1041.743,555.606 1042,556C1042.257,556.394 1096,509 1096,509C1096,509 1095.463,503.932 1072.483,489.934C1054.931,479.242 1016.205,454.426 979,452C948.412,450.006 925.914,456.836 911.067,462.492C886.416,471.882 877.236,495.141 877,495C876.662,494.798 835,453 835,453L744,452Z" />
                    </g>
                    <g transform="matrix(1.37,0,0,1.37,-289.82,-313.56)">
                        <path
                            d="M1183,694L1234,748C1234,748 1155.113,837.808 1089,877C1022.887,916.192 1000.168,920.305 977,921C953.832,921.695 924.053,922.387 888,890C851.947,857.613 857.689,810.567 860,799C873.739,730.228 909,695 909,695C909,695 931.707,718.65 945.858,732.193C949.163,735.356 965.677,748.306 963.763,750.971C941.523,781.931 932.751,802.565 933.475,818.361C934.748,846.154 969.536,864.802 1029.506,832.382C1056.314,817.889 1090.491,790.627 1115.604,769.002C1156.146,734.09 1180.304,702.84 1183,694Z" />
                    </g>
                    <g transform="matrix(1.37,0,0,1.37,-289.82,-313.56)">
                        <path
                            d="M999,628L1051,683C1051,683 1157.547,553.328 1215,525C1334.784,465.939 1333.516,549.266 1272,624L1325,678C1325,678 1416.341,572.078 1359,496C1323.314,448.653 1262.505,442.039 1206,462C1170.539,474.527 1094.53,521.747 999,628Z" />
                    </g>
                    <g transform="matrix(1.37,0,0,1.37,-289.82,-313.56)">
                        <path
                            d="M1134,625C1134,625 1188.485,576.061 1191,575C1193.515,573.939 1308.802,693.23 1311,695C1313.198,696.77 1361.804,759.6 1362,760C1406.215,850.153 1345.841,922.442 1267.463,921.778C1242.754,921.569 1217.503,915.587 1185.559,897.067C1184.554,896.484 1139.912,868.02 1141.05,867.029C1159.681,850.811 1195,816 1195,816C1195,816 1270.279,873.542 1298,832C1331.093,782.408 1134,625 1134,625Z" />
                    </g>
                </g>
            </svg>
        </div>

        <!-- 2. El Texto -->
        <h1 class="font-bold text-lg tracking-wide text-gray-800 dark:text-white">CIVIC KNIT</h1>
    </a>

    <!-- nuevo chat -->
    <div class="p-3 pb-0">
        <button @click="createNewChat()"
            class="flex items-center justify-center gap-3 w-full px-3 py-3 rounded-xl text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 shadow-md hover:shadow-lg transition-all group">
            <svg class="w-5 h-5 transition-transform group-hover:rotate-90" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            <span x-text="t[lang].new_chat">Nuevo Chat</span>
        </button>
    </div>

    <!-- historial -->
    <div class="flex-1 overflow-y-auto px-2 py-2 mt-2 custom-scrollbar" x-show="isLoggedIn">
        <div class="flex items-center justify-between px-3 mb-2 mt-2">
            <div class="text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span x-text="t[lang].history">HISTORIAL</span>
            </div>
            <button @click="clearAllChats()" x-show="chats.length > 0"
                class="text-gray-400 hover:text-red-500 transition-colors" title="Borrar todo el historial">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </button>
        </div>

        <div class="space-y-1">
            <template x-for="chat in chats" :key="chat.id">
                <div class="group flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-colors cursor-pointer"
                    :class="activeChatId === chat.id ? 'bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 font-medium' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800'"
                    @click="activeChatId = chat.id; mobileMenuOpen = false">

                    <svg class="w-4 h-4 shrink-0 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z">
                        </path>
                    </svg>

                    <span class="truncate flex-1" x-text="chat.title"></span>

                    <button @click="deleteChat(chat.id, $event)"
                        class="opacity-0 group-hover:opacity-100 hover:text-red-500 transition-opacity p-1"
                        title="Eliminar">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                    </button>
                </div>
            </template>

            <div x-show="chats.length === 0" class="text-xs text-gray-400 px-3 italic py-2">
                No hay historial.
            </div>
        </div>
    </div>

    <div class="flex-1" x-show="!isLoggedIn"></div>

    <!-- footer -->
    <div class="mt-auto p-4 border-t border-gray-200 dark:border-gray-700 space-y-2 bg-gray-50 dark:bg-gray-900/50">

        <!-- ajustes -->
        <template x-if="isLoggedIn">
            <button @click="showSettingsModal = true"
                class="flex items-center gap-3 w-full p-2 rounded-lg transition-colors text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800 group">
                <svg class="w-5 h-5 text-gray-500 group-hover:text-blue-500 transition-colors" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                    </path>
                </svg>
                <span x-text="t[lang].settings">Ajustes</span>
            </button>
        </template>

        <!-- sesion -->
        <template x-if="!isLoggedIn">
            <button @click="login()"
                class="flex items-center gap-3 w-full p-2 rounded-lg transition-colors text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800 group">
                <svg class="w-5 h-5 text-gray-500 group-hover:text-blue-600 transition-colors" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1">
                    </path>
                </svg>
                <span x-text="t[lang].login">Iniciar Sesión</span>
            </button>
        </template>

        <template x-if="isLoggedIn">
            <button @click="logout()"
                class="flex items-center gap-3 w-full p-2 rounded-lg transition-colors text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800 group">
                <svg class="w-5 h-5 text-gray-500 group-hover:text-gray-700 dark:group-hover:text-white transition-colors"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1">
                    </path>
                </svg>
                <span x-text="t[lang].logout">Cerrar Sesión</span>
            </button>
        </template>

        <!-- politicas de privacidad -->
        <div class="pt-2 mt-2 border-t border-gray-200 dark:border-gray-700/50 text-center">
            <a href="#" @click.prevent="showPrivacyModal = true"
                class="text-[10px] text-gray-400 hover:text-blue-500 hover:underline transition-colors"
                x-text="(t[lang] && t[lang].privacy) ? t[lang].privacy : 'Política de Privacidad'">
                Política de Privacidad
            </a>
        </div>
    </div>
</aside>